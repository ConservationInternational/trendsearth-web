{% load static %}
<html>

<head>
    <meta name="viewport" content="user-scalable=no, width=device-width, initial-scale=1.0, maximum-scale=1.0">
    <link rel="icon" href="{% static 'images/trends_earth_logo_square_32x32.png' %}">
    <link rel="stylesheet" type="text/css" href="{% static 'css/bootstrap.min.css' %}" />
    <link rel="stylesheet" type="text/css" href="{% static 'css/font-awesome.min.css' %}" />
    <link rel="stylesheet" type="text/css" href="{%  static 'css/ol.css' %}" />
    <link rel="stylesheet" type="text/css" href="{% static 'css/home.css' %}">
</head>

<body>
    {% block messages %}
    <ul class="messages" id="messages-list">
        {% if messages %}
        {% for message in messages %}
        <li>
            {% if message.tags %}
            <div class="alert alert-{{ message.tags }} msg fade show" role="alert">{{ message }}</div>
            {% else %}
            <div class="alert alert-info msg fade show" role="alert">{{ message }}</div>
            {% endif %}
        </li>
        {% endfor %}
        {% endif %}
    </ul>
    {% endblock %}
    <div class="container-fluid">
        <div class="row-flex">
            <div id="side-panel">
                <div class="row welcome-div">
                    <div class="col-md-2">
                        <img src="{% static 'images/trends_earth_logo_square_32x32.png' %}" width="32px">
                    </div>
                    <div class="col-md-8">
                        <span>WELCOME TO</span>
                        <span style="color: #dc3545; ">TRENDS.EARTH</span>
                    </div>
                </div>
                <div class="about">
                    <h2>About</h2>
                    <p>
                        Trends.Earth (formerly the Land Degradation Monitoring Toolbox) is a platform from <a
                            href="http://www.conservation.org/trendsearth">Conservation
                            International</a> for monitoring land change using earth observations in an
                        innovative
                        desktop
                        and cloud-based system.
                    </p>

                    <p>
                        Trends.Earth (formerly the Land Degradation Monitoring Toolbox) is a platform from <a
                            href="http://www.conservation.org/trendsearth">Conservation
                            International</a> for monitoring land change using earth observations in an
                        innovative
                        desktop
                        and cloud-based system.
                    </p>
                    <p>
                        Trends.Earth (formerly the Land Degradation Monitoring Toolbox) is a platform from <a
                            href="http://www.conservation.org/trendsearth">Conservation
                            International</a> for monitoring land change using earth observations in an
                        innovative
                        desktop
                        and cloud-based system.
                    </p>
                </div>
            </div>
            <div class="col-flex">
                <div id="map" class="col-flex">
                    <div class="menu_panel">
                        <div class="dropdown">
                            <button class="btn-menu-item" type="button" id="dropdownMenuAbout" data-bs-toggle="dropdown"
                                data-bs-display="static" aria-expanded="false">
                                <i class="fa fa-info-circle"></i>
                                About
                            </button>

                        </div>
                        <div style="display: flex;">
                            <ul class="menu-bar_menu">
                                <li class="menu-bar_menu-item">
                                    <div class="dropdown">
                                        <a role="button" class="btn-menu-item" id="dropdownMenuRegister"
                                            href="{% url 'register' %}">
                                            <i class="fa fa-user-plus"></i>Register
                                        </a>
                                    </div>
                                </li>
                                <li class="menu-bar_menu-item">
                                    <div class="dropdown">
                                        <a class="btn-menu-item" role="button" id="dropdownMenuLogin"
                                            href="{% url 'login' %}">
                                            <i class="fa fa-sign-in"></i>Login
                                        </a>
                                    </div>
                                </li>

                            </ul>
                        </div>
                    </div>
                </div>
                <div class="row footer">
                    <div class="col-sm-4">
                        <span>© OpenStreetMap contributors, © CartoDB CC-BY 3.0</span>
                    </div>
                    <div class="col-sm-3">
                        <span>Lat 0</span>&nbsp; | &nbsp; <span>Lon 0</span>
                        <span>&nbsp; | &nbsp; 1000 KM</span>
                    </div>
                    <div class="col-sm-5">
                        &copy; {% now 'Y' %} Conservation International &nbsp;&nbsp; | &nbsp;&nbsp;
                        Trends.Earth
                    </div>
                </div>
            </div>
        </div>
    </div>
    {% block footer-js %}
    <script type="text/javascript" src="{% static 'js/jquery.min.js' %}"></script>
    <script type="text/javascript" src="{% static 'js/popper.min.js' %}"></script>
    <script type="text/javascript" src="{% static 'js/bootstrap.min.js' %}"></script>
    <script type="text/javascript" src="{% static 'js/jquery.dataTables.min.js' %}"></script>
    <script type="text/javascript" src="{% static 'js/dataTables.bootstrap5.min.js' %}"></script>
    <script type="text/javascript" src="{% static 'js/select2.min.js' %}"></script>
    <script type="text/javascript" src="{% static 'js/dataTables.select.min.js' %}"></script>
    <script type="text/javascript" src="{% static 'js/bs-stepper.min.js' %}"></script>
    <script type="text/javascript" src="{% static 'js/ol.js' %}"></script>
    <script type="text/javascript" src="{% static 'js/app.js' %}"></script>

    <script>
        $(document).ready(function () {
            $(document).click(function () {
                console.log($(".dropdown-menu").hasClass('show'));
                //$(".dropdown").removeClass('open');
            });

            $('.dropdown-menu').click(function (e) {
                e.stopPropagation();
            });

            $("#country").on("change", function () {
                $.get("/ajax/regions?country_id=" + $(this).val(), function (response, status) {
                    $("#region").empty();
                    $("#region").append(response);
                });
            });

            $("#btn_register_user").on("click", function () {
                $("#username").val($("#email").val());
                let formData = new FormData(document.getElementById("registration-form"));
                formData.append("csrfmiddlewaretoken", "{{csrf_token}}");

                $.ajax({
                    url: "/register/user",
                    type: "POST",
                    dataType: "json",
                    data: formData,
                    processData: false,
                    contentType: false,
                    success: function (response) {
                        $("#messages-list").removeClass("msg-white");
                        $("#messages-list").addClass("msg-dark");
                        const messages = document.getElementById("messages-list");
                        messages.innerHTML += response.msg;

                        $("#messages-list").fadeOut(2000, "swing", function () {
                            messages.innerHTML = "";
                            $("#messages-list").show();
                            $("#messages-list").removeClass("msg-black");
                            $("#messages-list").addClass("msg-white");
                            window.location = response.url;
                        });
                    },
                    error: function (response) {
                        $("#alert_error").show();
                        $("#alert_error").empty();
                        $("#alert_error").html(response.responseText);
                        $("#alert_error").fadeOut(2000, "swing", function () { });
                    }
                });

            });
            var mainView = new ol.View({
                center: [0, 0],
                minZoom: 1,
                maxZoom: 20,
                zoom: 3,
            });

            var mainMap = new ol.Map({
                controls: [],
                target: "map",
                view: mainView,
            });

            var baseLayer = new ol.layer.Tile({
                name: "Base Map",
                source: new ol.source.TileImage({
                    url: "https://c.tile.openstreetmap.org/{z}/{x}/{y}.png",
                }),
            });

            // Add the base layer to the maps
            mainMap.addLayer(baseLayer);
        });
    </script>
    {% endblock %}
</body>

</html>